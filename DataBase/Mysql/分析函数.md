# 分析函数

## 1、over(order by) 排序

### 1、row_number() over(order by )

通过行号排序

```mysql
select
	*,
	row_number() over(order by id) t_rank
from
	stadium
where
	people>99
```

结果

| id   | visit_date | people | t_rank |
| ---- | ---------- | ------ | ------ |
| 2    | 2017-01-02 | 109    | 1      |
| 3    | 2017-01-03 | 150    | 2      |
| 5    | 2017-01-05 | 145    | 3      |
| 6    | 2017-01-06 | 1455   | 4      |
| 7    | 2017-01-07 | 199    | 5      |
| 8    | 2017-01-09 | 188    | 6      |

### 2、	rank() over(order by ) 排名

根据人员数量排名，相同数据排名相同。

```mysql
select
	*,
	rank() over(order by people) t_rank
from
	stadium
```
结果
| id                                | visit_date | people | t_rank |
| --------------------------------- | ---------- | ------ | :----: |
| 1                                 | 2017-01-01 | 10     |   1    |
| 9                                 | 2017-01-01 | 10     |   1    |
| 4                                 | 2017-01-04 | 99     |   3    |
| 2                                 | 2017-01-02 | 109    |   4    |
| 5                                 | 2017-01-05 | 145    |   5    |
| 3                                 | 2017-01-03 | 150    |   6    |
| 8                                 | 2017-01-09 | 188    |   7    |
| 7                                 | 2017-01-07 | 199    |   8    |
| 6                                 | 2017-01-06 | 1455   |   9    |

## 2、over(partition by）分组

### 1、统计

根据人员数量分组统计

```mysql
select 
    *,
    count(*)over(partition by people) 
from
	stadium
```

结果

| id   | visit_date | people | count(*)over(partition by people) |
| ---- | ---------- | ------ | --------------------------------- |
| 1    | 2017-01-01 | 10     | 2                                 |
| 9    | 2017-01-01 | 10     | 2                                 |
| 4    | 2017-01-04 | 99     | 1                                 |
| 2    | 2017-01-02 | 109    | 1                                 |
| 5    | 2017-01-05 | 145    | 1                                 |
| 3    | 2017-01-03 | 150    | 1                                 |
| 8    | 2017-01-09 | 188    | 1                                 |
| 7    | 2017-01-07 | 199    | 1                                 |
| 6    | 2017-01-06 | 1455   | 1                                 |

### 3、分组统计排序

首先通过用户数量分组，然后在此基础上根据ID进行降序排序

```mysql
select 
    *,
    count(*)over(partition by people order by id DESC) 
from
	stadium
```
结果

| id   | visit_date | people | count(*)over(partition by people order by id DESC) |
| ---- | ---------- | ------ | -------------------------------------------------- |
| 9    | 2017-01-01 | 10     | 1                                                  |
| 1    | 2017-01-01 | 10     | 2                                                  |
| 4    | 2017-01-04 | 99     | 1                                                  |
| 2    | 2017-01-02 | 109    | 1                                                  |
| 5    | 2017-01-05 | 145    | 1                                                  |
| 11   | 2017-01-03 | 150    | 1                                                  |
| 10   | 2017-01-03 | 150    | 2                                                  |
| 3    | 2017-01-03 | 150    | 3                                                  |
| 8    | 2017-01-09 | 188    | 1                                                  |
| 7    | 2017-01-07 | 199    | 1                                                  |
| 6    | 2017-01-06 | 1455   | 1                                                  |